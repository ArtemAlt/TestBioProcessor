name: Build and Release APK

on:
  push:
    tags:
      - 'v*'  # –ó–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–µ–≥–æ–≤ v1.0.0, v1.2.3 –∏ —Ç.–¥.

jobs:
  build-and-release:
    name: Build APK and Create Release
    runs-on: ubuntu-latest

    steps:
      # –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
      - name: Checkout code
        uses: actions/checkout@v4

      # –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å JDK 17
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      # –®–∞–≥ 3: –°–¥–µ–ª–∞—Ç—å gradlew –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
      - name: Make gradlew executable
        run: chmod +x ./gradlew

      # –®–∞–≥ 4: –°–æ–±—Ä–∞—Ç—å Debug APK
      - name: Build Debug APK
        run: ./gradlew assembleDebug

      # –®–∞–≥ 5: –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–µ—Ä—Å–∏–∏
      - name: Get version info
        id: version
        run: |
          echo "TAG_NAME=${GITHUB_REF#refs/tags/}" >> $GITHUB_OUTPUT
          echo "SHORT_SHA=$(git rev-parse --short HEAD)" >> $GITHUB_OUTPUT
          echo "DATE=$(date +'%Y-%m-%d %H:%M')" >> $GITHUB_OUTPUT

      # –®–∞–≥ 6: –°–æ–∑–¥–∞—Ç—å Release –∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å APK
      - name: Create GitHub Release
        id: create_release
        uses: softprops/action-gh-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: ${{ github.ref_name }}
          name: Release ${{ github.ref_name }}
          body: |
            ## üöÄ TestBioProcessor ${{ github.ref_name }}
            
            ### üì¶ –ß—Ç–æ –Ω–æ–≤–æ–≥–æ:
            - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞ APK
            - –í–µ—Ä—Å–∏—è: **${{ github.ref_name }}**
            - –ö–æ–º–º–∏—Ç: ${{ steps.version.outputs.SHORT_SHA }}
            - –°–æ–±—Ä–∞–Ω–æ: ${{ steps.version.outputs.DATE }}
            
            ### üì± –£—Å—Ç–∞–Ω–æ–≤–∫–∞:
            1. –°–∫–∞—á–∞–π—Ç–µ APK —Ñ–∞–π–ª –Ω–∏–∂–µ
            2. –†–∞–∑—Ä–µ—à–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É –∏–∑ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
            3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
            
            ### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:
            - –¢–∏–ø —Å–±–æ—Ä–∫–∏: Debug
            - –ü–æ–¥–ø–∏—Å—å: Debug key
            - –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            
            ---
            *–°–æ–±—Ä–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å GitHub Actions*
          draft: false
          prerelease: false
          files: |
            app/build/outputs/apk/debug/app-debug.apk
          asset_name: TestBioProcessor-${{ github.ref_name }}.apk

      # –®–∞–≥ 7: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
      - name: Success Notification
        if: success()
        run: |
          echo "‚úÖ APK –£–°–ü–ï–®–ù–û –°–û–ë–†–ê–ù –ò –û–ü–£–ë–õ–ò–ö–û–í–ê–ù!"
          echo "---"
          echo "üì± –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: TestBioProcessor"
          echo "üè∑Ô∏è –í–µ—Ä—Å–∏—è: ${{ github.ref_name }}"
          echo "üîó –°—Å—ã–ª–∫–∞ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è: https://github.com/${{ github.repository }}/releases/tag/${{ github.ref_name }}"
          echo "üìÖ –°–æ–±—Ä–∞–Ω–æ: ${{ steps.version.outputs.DATE }}"
          echo "üì¶ –§–∞–π–ª: TestBioProcessor-${{ github.ref_name }}.apk"
          echo "---"
          echo "üéâ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —Å–∫–∞—á–∞—Ç—å APK –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ Releases!"